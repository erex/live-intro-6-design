---
title: Exercise 6<br> Distance sampling survey design
author: Centre for Research into Ecological and Environmental Modelling <br> **University of St Andrews**
date: Introduction to distance sampling<br> April 2022
output: 
  rmdformats::readthedown:
    highlight: tango
---

<div class="alert  alert-success">
  <strong>Solutions</strong> Distance sampling survey design
</div>

# Systematic parallel line aerial survey of marine mammals in St Andrews bay

## Systematic Parallel Line Design

*What spacing would you select for this design? What is the maximum trackline length for the design you have selected? What on-effort line length are we likely to achieve?*

The spacing chosen by `dssd` of 4937.5 m to generate a line length of 200 km resulted in a maximum trackline length of around 261 km (each exact answer will vary due to the random generate of surveys). If we choose this design then it is possible that when we randomly generate our survey we may not be able to complete it with the effort we have available.

We should therefore increase the spacing between the transects and re-run the coverage simulations. A spacing of 5000 m gave a maximum trackline length of around 249 km (see summary table of Trackline length in the output below) so we can be fairly confident that we will be able to complete any survey which we randomly generate from this design. This spacing should allow us to achieve an on-effort line length of 199 km (see Line length section of design summary below). The minimum line length we would expect to achieve is 184 km and the maximum is 206 km. [Note your values might differ slightly to those below]

```{r prep, echo=FALSE}
library(dssd)
shapefile.name <- system.file("extdata", "StAndrew.shp", package = "dssd")
region <- make.region(region.name = "St Andrews Bay",
                      units = "m",
                      shape = shapefile.name)
cover <- make.coverage(region, n.grid.points = 5000)
```

```{r designspacingsol, eval=TRUE}
# Define the design
design.space500 <- make.design(region = region,
                      transect.type = "line",
                      design = "systematic",
                      spacing = 5000,
                      design.angle = 90,
                      edge.protocol = "minus",
                      truncation = 2000,
                      coverage.grid = cover)
```

```{r designspacingsol2, eval=TRUE, message=FALSE, fig.cap="Coverage grid plot for parallel design.", fig.width=5, fig.height=5}
# Run the coverage simulation
design.space500 <- run.coverage(design.space500, reps = 100, quiet=TRUE)
plot(design.space500)
```

```{r designspacingsol3, eval=TRUE}
# Display the design statistics
design.space500
```

## Equal Spaced Zigzag Design

*Does this design meet our survey effort constraint? What is the maximum total trackline length for this design? What line length are we likely to achieve with this design? Is this higher or lower than the systematic parallel design?*

You were asked to then run a coverage simulation and check if the trackline length was within our effort constraints. I found the maximum trackline length to be 242 km (see Trackline length summary table in the output below) so within our constraint of 250 km. I then got a mean line length of 221 km and minimum and maximum line lengths of 212 km and 227 km, respectively (see Line length summary table in the output below). We can therefore expect to achieve just over 20 km more on-effort survey line length with the zigzag design than the systematic parallel line design - that is a 10% gain! [Note your values may differ slightly]

```{r prep2}
design.zz.4500 <- make.design(region = region,
                      transect.type = "line",
                      design = "eszigzag",
                      spacing = 4500,
                      design.angle = 0,
                      edge.protocol = "minus",
                      bounding.shape = "convex.hull",
                      truncation = 2000,
                      coverage.grid = cover)
```

```{r zzcoveragesol, eval = TRUE,  fig.cap="Coverage grid plot for zigzag design.", fig.width=5, fig.height=5}
# Run coverage simulation
design.zz.4500 <- run.coverage(design.zz.4500, reps = 100, quiet=TRUE)
# Plot coverage
plot(design.zz.4500)
```

```{r zzcoveragesol3, eval = TRUE, echo = FALSE}
# Display design statistics
design.zz.4500
```

*Do you think the coverage scores look uniform across the study region? Where are they higher/lower? Why do you think this is?*

You were finally asked to look at the coverage scores across the survey region to see if this design has even coverage. There are some points with lower coverage around the survey region boundary. This is actually down to the fact we are using a minus sampling strategy. If we plotted coverage scores from a systematic parallel design we would see a similar pattern. Usually edge effects from minus sampling are minor unless we have a very long survey region boundary containing a small study area. If the fact that we are using a zigzag design was causing us issues with coverage we would expect to see higher coverage at the very top or very bottom of the survey region (as our design angle is 0). We do not see this. The survey region boundaries at the top and bottom are both quite wide and perpendicular to the design angle, in this situation zigzag designs perform well with regard to even coverage.

# Point Transect Bird Survey in Tentsmuir Forest

*What are the analysis implications of a design with unequal coverage?*

As our two strata have different coverage we should analyse them separately. We therefore need to make sure that we have sufficient transects in each strata to perform an analysis - ideally 20. There are 2 reasons that we should analyse them separately. Firstly, our covered area will not be representative of the study area as a whole. If density is higher or lower in one strata than the other we will get a biased estimate of abundance for the area as a whole using the standard distance sampling estimators. Secondly, pooling robustness between the two strata will no longer apply and it may be the case that detection functions differ between the two strata. We will no longer have a representative sample of observations across the entire study region either.

*What spacing was used in each strata to try and achieve the desired number of samplers? Did your survey achieve exactly the number of samplers you requested? Check if your neighbours achieved exactly the number of samplers requested. How much does coverage differ between the two strata for this realisation?*

```{r prep3, echo=FALSE, include=FALSE}
library(sf)
shapefile.name <- system.file("extdata", "TentsmuirUnproj.shp", package = "dssd")
sf.shape <- read_sf(shapefile.name)
st_crs(sf.shape)
proj4string <- "+proj=aea +lat_1=56 +lat_2=62 +lat_0=50 +lon_0=-3 +x_0=0 
                +y_0=0 +ellps=intl +units=m"
projected.shape <- st_transform(sf.shape, crs = proj4string)
region.tm <- make.region(region.name = "Tentsmuir",
                         strata.name = c("Main Area", "Morton Lochs"),
                         shape = projected.shape)
```

## Coverage

The next step is to set up a coverage grid. A coverage grid is a grid of regularly spaced points and is used to assess whether each point in the survey region is equally likely to sampled. The coverage grid needs to be created before the coverage simulation is run. 

```{r coveragegridtm}
# Set up coverage grid, with lots of grid points
#     This many grid points will slow down execution of this code;
#     I used this resolution to see fine detail in the plots for demonstration
#     If you adapt this code for your use, you may wish to initially reduce points
cover.tm <- make.coverage(region.tm, n.grid.points = 5000)
design.tm <- make.design(region = region.tm,
                         transect.type = "point",
                         design = "systematic",
                         samplers = c(25,15),
                         design.angle = 0,
                         edge.protocol = "minus",
                         truncation = 100,
                         coverage.grid = cover.tm)
survey.tm <- generate.transects(design.tm)
```


```{r surveytmsols}
survey.tm
```

A spacing of 751 m was used in the main stratum and 218 m in the Morton Lochs stratum - these values are calculated based on the stratum areas and should not vary between surveys generated from the same design. You may or may not have achieved the number of transects you requested, this will depend on the random start point calculated for your particular survey. There will also be some variability in coverage, my survey achieved a coverage of 5.7% in the main strata and 64.8% in the Morton Loch strata.

*First of all view the design statistics. What is the minimum number of samplers you will achieve in each strata? Is this sufficient to complete separate analyses in each stratum?*

```{r designtmsols2}
sims.tm <- run.coverage(design.tm, reps=100, quiet=TRUE)
sims.tm
```

My design statistics indicated I should achieve between 22 and 27 transects in the main stratum and between 12 and 18 in the Morton Lochs stratum. I might be a bit concerned about the possibility of only achieving 12 transects in the Morton Lochs stratum (remember I cannot just discard a survey due to the number of transects and generate another as it will affect my coverage properties!) but whether this is sufficient will depend on a number of things... what are the objectives of the study? how many detections are you likely to get from each transect? etc. Information from a pilot study would be useful to help decide how many transects are required as a minimum.

*Does it appear that you that there is even coverage within strata?*

```{r fig1, echo=FALSE, fig.cap="Coverage scores for each strata for the point transect Tentsmuir Forest survey design.",  fig.align='center'}
plot(sims.tm, strata.id=1, subtitle="Main area")
plot(sims.tm, strata.id=2, subtitle="Morton Lochs")
```

The main strata looks to have even fairly uniform coverage. The values appear to have such small levels of variability that the variability that is seen will be down to stochasticity as it is seen across the entire strata. The Morton Lochs strata we can see has areas of lower coverage around the edge of the study region. This grid is a bit too coarse to allow us to properly judge how much of an issue edge effects will be in this strata. It may be wise to re-run the coverage simulation with a finer coverage grid and more repetitions too. Edge effects could potentially be problematic in such small areas.


